<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
      integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css"
      integrity="sha384-QYIZto+st3yW+o8+5OHfT6S482Zsvz2WfOzpFSXMF9zqeLcFV0/wlZpMtyFcZALm"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
      integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
      crossorigin="anonymous"
    ></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Lilita+One&family=Martel:wght@700;900&family=Nunito&display=swap");
      *,
      html {
        font-family: "Lilita One", cursive;
      }
    </style>
  </head>
  <body>
    <div class="container clearfix">
      <div class="h-100 d-flex justify-content-center align-items-center">
        <form action="/" enctype="multipart/form-data" method="post">
          <div class="form-row align-items-center">
            <div class="col-auto text-center">
              <input
                type="file"
                class="form-control mb-2"
                name="uploaded_file"
                id="compress-file"
                required
              />
            </div>
            <div class="col-auto text-center">
              <button
                type="button"
                id="compress-button"
                class="btn btn-outline-info mb-2"
                onclick="compressImg()"
              >
                <span
                  class="spinner-grow spinner-grow-sm"
                  role="status"
                  aria-hidden="true"
                  id="buttom-spinner"
                ></span>
                <span class="visually" id="buttom-text">Compress</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <script>
      const compressImg = () => {
          const inputFile = document.getElementById('compress-file');
          const buttomSpin = document.getElementById('buttom-spinner');
          const buttomTxt = document.getElementById('buttom-text');
          const buttomComp = document.getElementById('compress-button');
          buttomSpin.setAttribute('class', 'spinner-grow spinner-grow-sm');
          buttomTxt.innerText = 'Compressing....';
          buttomComp.setAttribute('disabled', true);
          if (!inputFile.files.length) {
              buttomSpin.setAttribute('class', '');
              buttomTxt.innerText = 'Compress';
              buttomComp.setAttribute('disabled', false);
              return alert('Please upload image');
          }
          const formData = new FormData();
          const {name, type} = inputFile.files[0];
          if (!type.includes('image')) {
              buttomSpin.setAttribute('class', '');
              buttomTxt.innerText = 'Compress';
              buttomComp.setAttribute('disabled', false);
              return alert('Please upload valid image');
          }
          formData.append('file', inputFile.files[0]);
          formData.append('name', 'uploaded_file');
          formData.append('filename', name);
          fetch({
              method: 'POST',
              body: formData,
              headers: {
                  'Content-Type': 'multipart/form-data'
              }
          }).then((res)=>res.text()).then(res=>{
              buttomSpin.setAttribute('class', '');
              buttomTxt.innerText = 'Compress';
              buttomComp.setAttribute('disabled', false);
              console.log(res);
          }).catch(err=>{
              buttomSpin.setAttribute('class', '');
              buttomTxt.innerText = 'Compress';
              buttomComp.setAttribute('disabled', false);
              alert('Somthing wents wrong!!!');
          })
      }
    </script>
  </body>
</html>
